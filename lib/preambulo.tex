\newcommand{\ctext}[3][RGB]{
  \begingroup
  \definecolor{color}{#1}{#2}\sethlcolor{color}
  \hl{#3}
  \endgroup
}

\newcommand{\qbox}[1]{\ctext[RGB]{180, 180, 250}{#1}}
\newcommand\sbullet[1][.7]{\mathbin{\vcenter{\hbox{\scalebox{#1}{$\bullet$}}}}}
\newcommand{\Fonte}[1]{%
  \vspace*{5pt}%
  \noindent
  \footnotesize
  Fonte: #1%
  \normalsize
}

% main.tex - TCC ABNT 2025 (NBR 14724:2024 + NBR 6023:2025)
% NÃO USA ABNTEX2 - Usa memoir + biblatex-abnt

% PACOTES ESSENCIAIS
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{times}
\usepackage[brazil]{babel}
\usepackage[
  top=3cm, left=3cm, bottom=2cm, right=2cm,
  headheight=1cm, headsep=1cm
]{geometry}
\usepackage{graphicx}
\usepackage{microtype}
\usepackage{listofitems}
\usepackage{glossaries}
\usepackage{xstring}
\usepackage{setspace}
\usepackage{soul}
\usepackage[many]{tcolorbox}
\usepackage{placeins}
\usepackage{adjustbox}
\usepackage{amsfonts, amssymb, amsmath}
\usepackage{indentfirst}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{tcolorbox}
\usepackage[ruled]{algorithm2e}
\usepackage[format=plain,justification=justified,skip=10pt,singlelinecheck = false,labelsep=colon]{caption}
\usepackage{newfloat}
\usepackage{amsmath}
\usepackage{paracol}
\usepackage{titlesec}
\usepackage{etoolbox}
\usepackage{nicematrix}
\usepackage{titletoc}
\usepackage{calc}
\usepackage{ragged2e}

\makeatletter
\setlength\@fptop{0cm}
\makeatother

\tcbset{ % This targets the standard \tcbox
  colback=white,   % New default background color
  colframe=black!75
}

\DeclareFloatingEnvironment[
  fileext=loq,
  listname={Lista de Quadros},
  name=Quadro,
  placement=htbp,
  within=chapter
]{quadro}
\usepackage{tocloft}
\counterwithout{figure}{chapter}
\counterwithout{quadro}{chapter}


% BIBLIOGRAFIA CORRETA - NBR 6023:2025
\usepackage[
  backend=biber,
  style=abnt,          % Estilo ABNT (biblatex-abnt package)
  ittitles=true,       % Títulos em itálico (booleano válido)
  justify=true
]{biblatex}


\addbibresource{3-pos-textuais/referencias.bib}
\AtEveryBibitem{\global\expandafter\let\csname bbx@lasthash\endcsname\relax}

\AtEveryCitekey{\renewcommand*{\mkbibnamefamily}[1]{#1}}

\xpatchbibmacro{name:andothers}{\bibstring{andothers}}{\mkbibemph{\bibstring{andothers}}}{}{}
\DeclareFieldFormat{url}{\url{#1}}
\setlength{\bibitemsep}{1\baselineskip}
\renewcommand*{\finentrypunct}{}

\DeclareFieldFormat[online]{title}{\textbf{#1}} % Bold article titles
\DeclareFieldFormat[book]{title}{\textbf{#1}}    % Bold book titles
\DeclareFieldFormat{journaltitle}{\textbf{#1}}   % Bold journal names
\DeclareFieldFormat[inproceedings]{booktitle}{\textbf{#1}}
\DefineBibliographyStrings{brazil}{
  sineloco = {\mkbibemph{S}\adddot\addabbrvspace \mkbibemph{l}\adddot},
  sinenomine = {\mkbibemph{s}\adddot\addabbrvspace \mkbibemph{l}\adddot},
}

\renewbibmacro*{publisher+location+date}{%
  \iflistundef{location}
  {\iflistundef{publisher}
    {\printtext{[{\bibstring{sineloco}\addcolon\addspace\bibstring{sinenomine}}]}}
    {\printtext{[{\bibstring{sineloco}}]}\setunit*{\addcolon\space}\printlist{publisher}} % [S. l.]: Publisher
  }
  {\iflistundef{publisher}
    {\printlist{location}\setunit*{\addcolon\space}\printtext{[{\bibstring{sinenomine}}]}} % Location: [s. n.]
    {\printlist{location}\setunit*{\addcolon\space}\printlist{publisher}} % Location: Publisher
    %
  }
  \setunit*{\addcomma\space}%
  \usebibmacro{date}%
  \newunit}

\makeglossaries
\input{1-pre-textuais/lista-de-abreviaturas-e-siglas.tex}

\makeindex
\setlength{\parskip}{0pt}

\titleformat{\chapter}[hang]
{\normalfont\bfseries\fontsize{12}{14.4}\selectfont}
{\thechapter}
{1em}
{\MakeUppercase}

% Optional: adjust spacing before/after chapter title
\titlespacing*{\chapter}{0pt}{0pt}{20pt}

\titleformat{\section}
{\bfseries\fontsize{12}{14.4}\selectfont}
{\thesection}
{1em}
{}

% Subsection
\titleformat{\subsection}
{\normalfont\fontsize{12}{14.4}\selectfont}
{\thesubsection}
{1em}
{}

\titleformat{\subsubsection}
{\normalfont\fontsize{12}{14.4}\selectfont}
{\thesubsubsection}
{1em}
{}

% ESTILO DE CAPÍTULOS E SEÇÕES
\usepackage{fancyhdr}
\fancyhf{}
\fancyhead[R]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyhead[R]{\thepage}
  \renewcommand{\headrulewidth}{0pt}
}
\pagestyle{plain}

\makeatletter
\patchcmd{\@makechapterhead}
{\thispagestyle{plain}}
{\thispagestyle{abnt2025}}
{}{}
\makeatother

\setcounter{tocdepth}{3}

% Optional: also number subsubsections (ABNT allows it)
\setcounter{secnumdepth}{3}

\SetAlgoCaptionLayout{leftline}

\newcommand\commentstyle[1]{\textcolor{black!50}{#1}}
\SetAlgorithmName{Algoritmo}{Lista de Algoritmos}{algoritmo}

\SetCommentSty{commentstyle}
\DontPrintSemicolon
\SetArgSty{textnormal}
\SetKwFor{For}{para}{fazer}{fim para}
\SetKwFor{ForEach}{para cada}{fazer}{fim para cada}
\SetKwBlock{Inicio}{inicio}{fim}
\SetKwInput{Input}{Entrada}
\SetKwInput{Output}{Saida}
\SetKwIF{Ifx}{Elseifx}{Elsex}{se}{então}{senão, se}{senão}{fim}
\SetKwIF{If}{Elseif}{Else}{se}{então}{senão, se}{senão}{}
\SetKwIF{Ifx}{ElseIfx}{Elsex}{se}{então}{senão, se}{senão}{fim}
\SetKwIF{If}{ElseIf}{Else}{se}{então}{senão, se}{senão}{}
\SetKwRepeat{Repeat}{repetir}{até que}
\SetKwFor{While}{enquanto}{fazer}{fim enquanto}%
\SetKw{Return}{retornar}%
\SetKwSwitch{Switch}{Casex}{Other}{selecionar}{fazer}{caso}{senão}{fim}{fim}
\SetKwSwitch{Switchx}{Case}{Otherx}{selecionar}{fazer}{caso}{senão}{}{}
\SetKw{Continue}{continue}
% LEGENDAS - ALINHADO À ESQUERDA


\newcounter{quadrocount}
\NewDocumentEnvironment{myquadro}{ m m +b }
{
  \stepcounter{quadrocount}
  \begin{table}[ht]
    \setlength{\extrarowheight}{2pt}
    \captionsetup{width={\textwidth}}
    \captionof{quadro}{#2}#1
    \noindent

    % Create unique box name using counter
    \expandafter\newsavebox\csname quadrobox\thequadrocount\endcsname
    \expandafter\sbox\csname quadrobox\thequadrocount\endcsname{%
      \begin{NiceTabularX}{\textwidth} #3 \end{NiceTabularX}
    }
    \pgfmathsetlengthmacro{\tableheight}{\ht\csname quadrobox\thequadrocount\endcsname + \dp\csname quadrobox\thequadrocount\endcsname}

    \begin{tikzpicture}
      \begin{scope}
        \clip[rounded corners=5pt] (0,0) rectangle (\textwidth, \tableheight);
        \node[anchor=south west, inner sep=0pt] at (0,0) {\expandafter\usebox\csname quadrobox\thequadrocount\endcsname};
      \end{scope}
      \draw[rounded corners=5pt, line width=1.5pt, black] (0,0) rectangle (\textwidth, \tableheight);
    \end{tikzpicture}
    {\vspace*{5pt}\Fonte{fornecido pelo autor}}
  \end{table}
}
{}


\newlength{\myimgwidth}
\newlength{\myimgheight}
\NewDocumentEnvironment{mypicture}{m m m m +b}{
  \begin{figure}[!ht]
    \captionsetup{width=\textwidth}
    \caption{#1#2}
    \begin{tikzpicture}
      \setlength{\myimgwidth}{\textwidth}

      % Calculate height based on image's natural aspect ratio

      \settototalheight{\myimgheight}{\includegraphics[width=\myimgwidth]{#3}}

      \begin{scope}
        \clip[rounded corners=5pt] (0,0) rectangle (\myimgwidth, \myimgheight);
        \node (image) at (0.5\myimgwidth,0.5\myimgheight) {
          \includegraphics[width=\myimgwidth, height=\myimgheight]{#3}
        };
      \end{scope}
      \draw[rounded corners=5pt, line width=1.5pt] (0,0) rectangle (\myimgwidth, \myimgheight);
    \end{tikzpicture}
    {\Fonte{#4}}
  \end{figure}
}{}